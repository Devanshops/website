<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.17" />
    <meta name="description" content="Documentation for the Choria Orchestrator">
<meta name="author" content="R.I.Pienaar &lt;rip@devco.net&gt;">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />

    
    <title>First User</title>
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/horsey.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    <script src="/js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/deployment/first-user/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<div style="font-family: 'Raleway', serif; font-size: x-large">CHORIA</div>

    </div>
    
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
        
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/about/">
        <a href="/about/">
          <span>
            
              <b>1. </b>
            
             About Choria
            
           </span>
        </a>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/deployment/">
        <a href="/deployment/">
          <span>
            
              <b>2. </b>
            
             Deployment
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/deployment/requirements/">
              <a href="/deployment/requirements/">
                <span>Requirements     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/deployment/nats/">
              <a href="/deployment/nats/">
                <span>NATS Middleware     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/deployment/dns/">
              <a href="/deployment/dns/">
                <span>DNS Setup     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/deployment/mcollective/">
              <a href="/deployment/mcollective/">
                <span>MCollective     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/deployment/first-user/">
              <a href="/deployment/first-user/">
                <span>First User     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/deployment/next-steps/">
              <a href="/deployment/next-steps/">
                <span>Next Steps     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/configuration/">
        <a href="/configuration/">
          <span>
            
              <b>3. </b>
            
             Optional Configuration
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/configuration/puppetdb/">
              <a href="/configuration/puppetdb/">
                <span>PuppetDB Discovery     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/configuration/aaa/">
              <a href="/configuration/aaa/">
                <span>MCollective AAA     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/configuration/plugins/">
              <a href="/configuration/plugins/">
                <span>Plugin Distribution     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/configuration/gems/">
              <a href="/configuration/gems/">
                <span>Gem Distribution     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/configuration/app_orchestration/">
              <a href="/configuration/app_orchestration/">
                <span>Application Orchestrator     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/reference/">
        <a href="/reference/">
          <span>
            
              <b>4. </b>
            
             Reference
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/reference/nats/">
              <a href="/reference/nats/">
                <span>NATS Connector     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/reference/security/">
              <a href="/reference/security/">
                <span>SSL Security     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/development/">
        <a href="/development/">
          <span>
            
              <b>5. </b>
            
             Development
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/development/rest/">
              <a href="/development/rest/">
                <span>REST Server Support     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/development/messages/">
              <a href="/development/messages/">
                <span>Message Structure     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <p>Hosted at <a href="https://github.com/ripienaar/mcollective-choria">GitHub</a> by <a href="https://www.devco.net/">R.I. Pienaar</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                    
                    
                <a href="/deployment/" itemprop="url"><span itemprop="title">Deployment</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                  
                
                  
                
                <span itemprop="title"> First User</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#create-your-first-user">Create your first user</a></li>
<li><a href="#authorization">Authorization</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>First User</h1>
                



<p>Users who wish to manage nodes via MCollective need to have certificates signed by the Puppet CA.  Choria includes a tool to request and manage these certificates.</p>

<h2 id="create-your-first-user">Create your first user</h2>

<p>On the node you wish to run MCollective commands from you should have configured it as a <em>client</em> in the previous step.</p>

<pre><code class="language-bash">$ whoami
rip
</code></pre>

<p>When you are ready request the certificate from the CA, it will store it in the default location in <em>~/.puppetlabs</em> as per Puppet AIO standards.</p>

<div class="notices warning" ><p>You should not run any <em>mco</em> commands as <em>root</em>, this will produce an error.</p>
</div>


<pre><code class="language-bash">$ mco choria request_cert
</code></pre>

<p>This will request a certificate from your Puppet CA, you should sign it there and once signed it will be downloaded and saved.  If you cannot sign it immediately you can safely run this command again later.</p>

<p>By default as my username is <em>rip</em> the certificate that was requested will be <em>rip.mcollective</em>.  The default Choria setup only allows <em>*.mcollective</em> as certificate names.</p>

<p>You should now be able to run <em>mco ping</em> and see some of your nodes:</p>

<pre><code class="language-bash">$ mco ping
dev1.example.net                           time=55.35 ms
dev2.example.net                           time=57.67 ms
dev3.example.net                           time=59.52 ms
</code></pre>

<p>Most other commands will not work due to the <em>default deny</em> nature of the Choria so you have to set up some Authorization rules.</p>

<h2 id="authorization">Authorization</h2>

<p>As my user certificate is <em>rip.mcollective</em> and I wish to be able to manage all aspects of my MCollective I am going to add a default allow rule to <em>Hiera</em>, add this to your common tier or whichever tier will select the nodes you wish to be able to manage:</p>

<pre><code class="language-yaml">mcollective::site_policies:
  - action: &quot;allow&quot;
    callers: &quot;choria=rip.mcollective&quot;
    actions: &quot;*&quot;
    facts: &quot;*&quot;
    classes: &quot;*&quot;
</code></pre>

<p>Once this has been rolled out to your site you can go ahead and try commands like <code>mco puppet status</code>.</p>

<p>If you want to deploy further users I suggest you look at the <a href="../../configuration/aaa/">MCollective AAA</a> documentation section.</p>


      
      </div>
    </div>

    <div id="navigation">
        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky-kit.min.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>
    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-10152852-12', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


  </body>
</html>

